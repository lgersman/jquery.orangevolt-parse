<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>query.orangevolt.parse - lexer testcase</title>

<link type="text/css" rel="stylesheet" media="screen" href="testsuite.css"/>

<script language="javascript" src="../lib/jquery-1.3.2.js"></script>
<script language="javascript" src="lib/jqUnit.js"></script>
<script language="javascript" src="../jquery.orangevolt-parse.js"></script>

<script type="text/javascript">
with( jqUnit) {
	module( 'jquery.orangevolt.parse.purge');

	function match( value) {
		return { value : value};
	}
	
	function createAST() {
		var first =  $.orangevolt.parse.AST( { token : 'first'}, match( 'first'), undefined, []);
		var second = $.orangevolt.parse.AST( { token : 'second'}, match( 'second'), first, []);
		var third =  $.orangevolt.parse.AST( { token : 'third'}, match( 'third'), second, []);

		return first.getFirstSibling();
	}
	
	test( 'doNothing', function() {
		var ast = createAST();
		
		ast = ast.purge( function( ast, condition) {
			return this;
		});

		setTimeout( function() {
			$('body').append( $('<p style="width:12000px">').append( ast.html()));
		}, 50);	
	});	

	test( 'remove head', function() {
		var ast = createAST();
		
		ast = ast.purge( function( ast, condition) {
			if( ast.rule.token=='first') {
				return undefined;
			}
			return this;
		});

		$('body').append( $('<p style="width:12000px">').append( ast.html()));
	});	

	test( 'remove tail', function() {
		var ast = createAST();
		
		ast = ast.purge( function( ast, condition) {
			if( ast.rule.token=='third') {
				return undefined;
			}
			return this;
		});

		$('body').append( $('<p style="width:12000px">').append( ast.html()));
	});	

	test( 'remove between', function() {
		var ast = createAST();
		
		ast = ast.purge( function( ast, condition) {
			if( ast.rule.token=='second') {
				return undefined;
			}
			return this;
		});

		$('body').append( $('<p style="width:12000px">').append( ast.html()));
	});	
}
</script>

</head>
<body>
	<pre>
/* 
 * Copyright (c) 2009 Lars Gersmann (lars.gersmann@gmail.com, http://orangevolt.blogspot.com)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 */	
	</pre>

	<h3>test results</h3>

	 <!-- Test HTML -->
    <div id="main" style="display: none;">
      <form id="test-form">
        <input/>
      </form>
      <div id="ajax">
        
      </div>
    </div>
    <ol id="tests"></ol>
</body>
</html>